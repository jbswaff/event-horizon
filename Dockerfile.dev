FROM python:3.11-slim

# Install watchfiles for hot reload
RUN pip install --no-cache-dir watchfiles

# Create app directory
WORKDIR /app

# Create necessary directories
RUN mkdir -p /var/log/event-horizon && \
    chmod 0755 /var/log/event-horizon

# Environment variables with defaults
ENV PORT=8080 \
    DISABLE_MINUTES=10 \
    SHOW_LOG_LINK=true \
    PIHOLE_COUNT=1

# Expose the server port
EXPOSE 8080

# Use watchfiles to auto-reload on changes
CMD ["watchfiles", "--filter", "python", "python3 /app/server.py", "/app"]
